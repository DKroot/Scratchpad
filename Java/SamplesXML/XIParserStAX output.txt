XI(@version = 1.015)
  domain(@name = learn/learning; @version = 1.0)
    header
      alias(@id = fp; @name = base)
      alias(@id = res; @name = learn/Reservation)
    types
      event(@id = NoSeatsAvailable; @name = NoSeatsAvailable; @parent = null)
      event(@id = AccessDenied; @name = AccessDenied; @parent = null)
      event(@id = InvalidTimimg; @name = InvalidTimimg; @parent = null)
      event(@id = InvalidStatus; @name = InvalidStatus; @parent = null)
      event(@id = NeedToCancel; @name = NeedToCancel; @parent = null)
      event(@id = EventHasBeenCancelled; @name = EventHasBeenCancelled; @parent = null)
      document(@id = learn/learning:Event1; @name = Event1; @parent = null)
      document(@id = learn/learning:EnrollmentRequest; @name = EnrollmentRequest; @parent = null)
        attribute(@name = cool)
          <body><text id="1">This is an attribute. Any simple XML will do.</text></body>
        field(@name = Complex; @domain = null; @type = EventSchedule)
          field(@name = One; @domain = fp; @type = document)
          field(@name = Two; @domain = fp; @type = document)
        field(@name = Schedule; @domain = res; @type = EventSchedule)
        field(@name = Access; @domain = null; @type = variantAccess)
        field(@name = Timing; @domain = null; @type = variantTiming)
        field(@name = Status; @domain = null; @type = enumStatus)
        field(@name = CancelStatus; @domain = null; @type = enumCancelStatus)
        function(@name = Deny)
          block(@type = null)
        function(@name = Cancel)
          block(@type = null)
            set(@name = Status; @value = Cancelled)
            switch(@name = Timing)
              branch
                switch(@name = Before)
                block(@type = null)
                  set(@name = CancelStatus; @value = Normal)
              branch
                switch(@name = else)
                block(@type = null)
                  set(@name = CancelStatus; @value = Late)
        function(@name = CancelAdmin)
          block(@type = null)
            set(@name = Status; @value = Cancelled)
            set(@name = CancelStatus; @value = Normal)
        function(@name = Confirm)
          block(@type = null)
            switch(@name = Schedule/Seats)
              branch
                switch(@name = Available)
                block(@type = null)
                  set(@name = Status; @value = Confirmed)
              branch
                switch(@name = else)
                block(@type = null)
                  failure(@name = NoSeatsAvailable)
        function(@name = Attend)
          block(@type = null)
            switch(@name = Access)
              branch
                switch(@name = Denied)
                block(@type = null)
                  failure(@name = AccessDenied)
            switch(@name = Status)
              branch
                switch(@name = Confirmed)
                block(@type = null)
                  switch(@name = Timing)
                    branch
                      switch(@name = During)
                      switch(@name = After)
                      block(@type = null)
                        set(@name = Status; @value = Attended)
                        invoke(@name = Attend; @obj = Schedule)
                    branch
                      switch(@name = else)
                      block(@type = null)
                        failure(@name = InvalidTimimg)
              branch
                switch(@name = else)
                block(@type = null)
                  failure(@name = InvalidStatus)
      role(@id = learn/learning:Participant; @name = Participant; @parent = null)
        function(@name = FindRequest)
          block(@type = null)
        function(@name = EnrollToClass)
          block(@type = null)
        function(@name = CancelRequest)
          block(@type = null)
            invoke(@name = Cancel; @obj = Request)
        function(@name = AttendEvent)
          block(@type = null)
      role(@id = learn/learning:Manager; @name = Manager; @parent = learn/learning:Participant)
        function(@name = EnrollSomeoneToClass)
          block(@type = null)
      role(@id = learn/learning:Admin; @name = Admin; @parent = learn/learning:Manager)
        function(@name = CreateEvent)
          block(@type = null)
        function(@name = CreateSchedule)
          block(@type = null)
        function(@name = ApproveRequest)
          block(@type = null)
            invoke(@name = Confirm; @obj = Request)
        function(@name = DenyRequest)
          block(@type = null)
            invoke(@name = Deny; @obj = Request)
        function(@name = CancelRequest)
          block(@type = null)
            switch(@name = null)
              branch
                switch(@name = 1)
                block(@type = null)
                  invoke(@name = CancelAdmin; @obj = Request)
              branch
                switch(@name = 2)
                block(@type = null)
                  invoke(@name = Cancel; @obj = Request)
    process(@name = AttendTheEvent; @id = learn/learning:AttendTheEvent)
      field(@name = P; @domain = null; @type = learn/learning:Participant)
      field(@name = Request; @domain = null; @type = learn/learning:EnrollmentRequest)
      task(@name = EnrollStudent)
        block(@type = null)
          switch(@name = null)
            branch
              switch(@name = 1)
              block(@type = null)
                invoke(@name = EnrollToClass; @obj = P)
            branch
              switch(@name = 2)
              block(@type = null)
                invoke(@name = EnrollSomeoneToClass; @obj = DM)
            branch
              switch(@name = 3)
              block(@type = null)
                invoke(@name = EnrollSomeoneToClass; @obj = Adm)
      task(@name = PossibleEvents)
        block(@type = null)
      task(@name = .)
        block(@type = null)
          invoke(@name = EnrollStudent; @obj = null)
          wait(@name = Schedule/StartDate)
            block(@type = null)
              invoke(@name = PossibleEvents; @obj = null)
              onevent(@name = NeedToCancel)
                block(@type = null)
                  invoke(@name = CancelRequest; @obj = P)
              onevent(@name = EventHasBeenCancelled)
                block(@type = null)
    process(@name = ProvideTraining; @id = learn/learning:ProvideTraining)
      field(@name = Adm; @domain = null; @type = learn/learning:Admin)
      field(@name = Schedule; @domain = null; @type = learn/reservation:EventSchedule)
      task(@name = ScheduleEvent)
        block(@type = null)
          invoke(@name = CreateSchedule; @obj = Adm)
      task(@name = EnrollStudents)
        block(@type = null)
          many
            block(@type = null)
      task(@name = .)
        block(@type = null)
          invoke(@name = ScheduleEvent; @obj = null)
          invoke(@name = EnrollStudents; @obj = null)
    process(@name = ManageEvents; @id = learn/learning:ManageEvents)
      field(@name = Adm; @domain = null; @type = learn/learning:Admin)
      task(@name = RegisterEvent)
        block(@type = null)
          invoke(@name = CreateEvent; @obj = Adm)
      task(@name = .)
        block(@type = null)
          many
            block(@type = null)
              invoke(@name = RegisterEvent; @obj = null)
              invoke(@name = ProvideTraining; @obj = null)
