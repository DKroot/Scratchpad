version: '2'
services:
  demo_vue_docker:
    image: demo_vue_docker
    environment:
      - _JAVA_OPTIONS=-Xmx512m -Xms256m
      - 'SPRING_PROFILES_ACTIVE=prod,swagger'
      - MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED=true
      - 'SPRING_DATASOURCE_URL=jdbc:sqlserver://demo_vue_docker-mssql:1433;database=demo_vue_docker'
      - JHIPSTER_SLEEP=30
    ports:
      - '8080:8080'
  demo_vue_docker-mssql:
    image: 'mcr.microsoft.com/mssql/server:2017-latest-ubuntu'
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_PID=Express
      - SA_PASSWORD=yourStrong(!)Password
      - MSSQL_DATABASE=demo_vue_docker
      - MSSQL_SLEEP=60
    command: /bin/bash -c '/opt/mssql/bin/sqlservr & echo "wait $$MSSQL_SLEEP sec for DB to start "; sleep $$MSSQL_SLEEP; /opt/mssql-tools/bin/sqlcmd -U sa -P $$SA_PASSWORD -d tempdb -q "EXIT(CREATE DATABASE $$MSSQL_DATABASE)"; wait;'
